<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía de autoconsumo solar</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;700&display=swap" onload="this.rel='stylesheet'" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="preload" as="style" href="../assets/css/global.css" onload="this.rel='stylesheet'" />
    <link rel="preload" as="style" href="../assets/css/calculator.css" onload="this.rel='stylesheet'" />
    <script src="../assets/js/scripts.js" defer></script>
    <script src="../assets/js/calculator.js" defer></script>
    <script src="../assets/js/form.js" defer></script>
    <script src="../assets/js/send-complete.js" defer></script>
    <script src="../assets/js/alpine.min.js" defer></script>
    <script src="../src/Calculadora.js"></script>
    <meta name="description" content="Cómo puedo hacer autoconsumo solar" />
</head>

<body class="page-calculadora" x-data="{
    calculadora: calc1,
    screen: 'landing'
}">
        <menu id="topmenu">
        <div class="title">Guía de autoconsumo solar</div>
        <div class="logo"><img src="../assets/img/greenpeace.svg" alt="Greenpeace" width="184" height="29" /></div>
        <div class="hamburger"><a href="javascript:void(0);" onclick="enter('#sidemenu', 'slideInLeft');"><img src="../assets/img/hamburger.svg" alt="Hamburger" /></a></div>
        <div class="autoconsumo"><a href="../">¿Cómo hacer autoconsumo solar?</a></div>
        <div class="calculadora"><a href="./">Calculadora de ahorro</a></div>
        <div class="descarga"><a href="../descarga-tu-guia/">Descarga tu guía</a></div>
    </menu>
    <menu id="sidemenu" hidden="hidden" class="animate__faster">
        
        <div id="insidemenu">
            <div class="topinside">
                <div class="title2">Guía de autoconsumo solar</div>
                <div class="logo2"><img src="../assets/img/greenpeace.svg" alt="Greenpeace" width="184" height="29" /></div>
                <div class="menulinks">
                    <div><a href="../">¿Cómo hacer autoconsumo solar?</a></div>
                    <div><a href="">Calculadora de ahorro</a></div>
                    <div><a href="../descarga-tu-guia/">Descarga tu guía</a></div>
                </div>
            </div>

            <div class="close2">
                <a href="javascript:void(0);" onclick="leave('#sidemenu', 'slideOutLeft');">
                    <img src="../assets/img/close.svg" alt="Cerrar" width="26" height="26" />
                </a>
            </div>

        </div>
    </menu>

    <h1>Calculadora de ahorro solar</h1>

    <p>Descubre cuánto puedes ahorrar en tu factura de la luz instalando placas solares y qué necesitarás para hacerlo.</p>

    <form id="signup" class="form" novalidate x-on:submit.prevent="" x-init="populate_utms()" x-data="{
        values : {
            utm_medium: '',
            utm_source: '',
            utm_campaign: '',
            utm_content: '',
            utm_term: '',
            gclid: '',
            ip: '',
            uagent: '',
            hs_language: 'es',
            first_name: '',
            last_name: '',
            email: '',
            id_number: '',
            phone_number: '',
            privacy: false,
            is_contact: false,
        },
        show_errors: false,
        errors: { 
            first_name: '',
            last_name: '',
            email: '',
            id_number: '',
            phone_number: '',
            privacy: '',
            form_sent: ''
        },
        async populate_utms(){
            const utmValues = await stringParams();
            this.values.utm_medium = utmValues.utm_medium;
            this.values.utm_source = utmValues.utm_source;
            this.values.utm_campaign = utmValues.utm_campaign;
            this.values.utm_content = utmValues.utm_content;
            this.values.utm_term = utmValues.utm_term;
            this.values.gclid = utmValues.gclid;
        }, 
        validate(){
            this.required('first_name');
            this.required('last_name');
            this.is_required_email('email');
            /* this.is_required_id_number('id_number'); */
            this.is_required_phone('phone_number');
            this.is_checked('privacy');
        },
        is_valid(){
            let valid = true;
            for ( const i in this.errors ){
                if ( this.errors[i] != ''){
                    valid = false;
                }
            }
            return valid;
        },
        async submit_form(){
            this.errors.form_sent = 'Yes';
            const answer = await sendToHubspot(this.values, calculadora);
            if (answer) {
                screen = 'thankyoupage';
            }
        },
        async is_new_email(){
            if ( this.errors.email ==='' ){
                const rawResponse = await fetch('https://apis.greenpeace.es/email-info/?' + new URLSearchParams({
                    email: this.values.email
                }));
                const content = await rawResponse.json();
                this.values.is_contact = content.is_contact;
            } else {
                this.values.is_contact = false;
                await console.log('Invalid email');
            }
        },
        required(field_name) {
            if ( this.values[field_name].trim().length < 2) {
                this.errors[field_name] = 'Campo obligatorio';
            } else {
                this.errors[field_name] = '';
            }
        },
        is_required_email(field_name) {
            if ( this.values[field_name].trim().length < 2) {
                this.errors[field_name] = 'Campo obligatorio';
            } else if ( !isValidEmail(this.values[field_name] ) ) {
                this.errors[field_name] = 'Un email válido por favor, ej. nombre@dominio.tld';
            } else {
                this.errors[field_name] = '';
            }
        },
        is_required_phone(field_name) {
            if ( this.values[field_name].trim().length < 2) {
                this.errors[field_name] = 'Campo obligatorio';
            } else if ( this.values[field_name].trim().length >= 1 && !isValidPhone( this.values[field_name] )) {
                this.errors[field_name] = 'Tu número de teléfono español por favor';
            } else {
                this.errors[field_name] = '';
            }
        },
        /* is_required_id_number(field_name) {
            if ( this.values[field_name].trim().length < 2) {
                this.errors[field_name] = 'Campo obligatorio';
            } else if ( !isValidIdNumber( this.values[field_name]) ){
                this.errors[field_name] = 'Un DNI o NIE españoles. Por ejemplo 82451384H o X6909535J.';
            } else {
                this.errors[field_name] = '';
            }
        }, */
        is_checked(field_name) {
            if ( this.values[field_name] === false ) {
                this.errors[field_name] = 'Falta aceptar la política de privacidad';
            } else {
                this.errors[field_name] = '';
            }
        }
    }">

        <h2>Ajusta los parámetros</h2>

        <div class="house">

            <div class="question" style="grid-area: consumo_anual;">
                <label for="consumo_anual">¿Cuál es tu consumo anual (kWh)?</label>
                <div><a href="javascript:void(0);"><img src="../assets/img/i.svg" alt="Más información" /></a></div>
                <input type="range" id="consumo_anual" x-model="calculadora.consumo_anual" min="0" max="10000" step="100" />
                <div x-text="calculadora.consumo_anual" class="actual_value"></div>
            </div>

            <div class="question" style="grid-area: porcentaje_consumo;">
                <label for="porcentaje_consumo">¿Qué porcentaje de tu consumo quieres cubrir con autoconsumo solar?</label>
                <div><a href="javascript:void(0);"><img src="../assets/img/i.svg" alt="Más información" /></a></div>
                <input type="range" id="porcentaje_consumo" x-model="calculadora.porcentaje_consumo" min="0" max="100" step="5" />
                <div class="actual_value"><span x-text="calculadora.porcentaje_consumo"></span>%</div>
            </div>

            <div class="question" style="grid-area: provincia;">
                <label>¿En qué provincia vives?</label>
                <select x-model="calculadora.provincia">
                    <option>Álava</option>
                    <option>Albacete</option>
                    <option>Alicante</option>
                    <option>Almería</option>
                    <option>Asturias</option>
                    <option>Ávila</option>
                    <option>Barcelona</option>
                    <option>Badajoz</option>
                    <option>Burgos</option>
                    <option>Cáceres</option>
                    <option>Castellón</option>
                    <option>Cádiz</option>
                    <option>Cantabria</option>
                    <option>Ciudad Real</option>
                    <option>Ceuta</option>
                    <option>Córdoba</option>
                    <option>A Coruña</option>
                    <option>Cuenca</option>
                    <option>Formentera</option>
                    <option>Girona</option>
                    <option>Granada</option>
                    <option>Guadalajara</option>
                    <option>Guipúzcoa</option>
                    <option>Huelva</option>
                    <option>Huesca</option>
                    <option>Ibiza</option>
                    <option>Jaén</option>
                    <option>Las Palmas</option>
                    <option>La Rioja</option>
                    <option>León</option>
                    <option>Lleida</option>
                    <option>Lugo</option>
                    <option>Madrid</option>
                    <option>Málaga</option>
                    <option>Mallorca</option>
                    <option>Melilla</option>
                    <option>Menorca</option>
                    <option>Murcia</option>
                    <option>Navarra</option>
                    <option>Ourense</option>
                    <option>Palencia</option>
                    <option>Pontevedra</option>
                    <option>Salamanca</option>
                    <option>Santa Cruz de Tenerife</option>
                    <option>Segovia</option>
                    <option>Sevilla</option>
                    <option>Soria</option>
                    <option>Tarragona</option>
                    <option>Teruel</option>
                    <option>Toledo</option>
                    <option>Valencia</option>
                    <option>Valladolid</option>
                    <option>Vizcaya</option>
                    <option>Zamora</option>
                    <option>Zaragoza</option>
                </select>
            </div>

            <div class="question" style="grid-area: orientacion_tejado;">
                <label>¿Cuál es la orientación de tu tejado?</label>
                <div><a href="javascript:void(0);"><img src="../assets/img/i.svg" alt="Más información" /></a></div>
                <img src="../assets/img/ilustracion-orientacion-tejado.svg" alt="Ilustración orientación del tejado" />
                <label for="Norte">Norte</label>
                <input type="radio" name="orientacion_tejado" x-model="calculadora.orientacion_tejado" value="Norte" id="Norte" />
                <label for="Sur">Sur</label>
                <input type="radio" name="orientacion_tejado" x-model="calculadora.orientacion_tejado" value="Sur" id="Sur" />
                <label for="Este">Este</label>
                <input type="radio" name="orientacion_tejado" x-model="calculadora.orientacion_tejado" value="Este" id="Este" />
                <label for="Oeste">Oeste</label>
                <input type="radio" name="orientacion_tejado" x-model="calculadora.orientacion_tejado" value="Oeste" id="Oeste" />
                <label for="Plano">Plano</label>
                <input type="radio" name="orientacion_tejado" x-model="calculadora.orientacion_tejado" value="Plano" id="Plano" />
            </div>

        </div>

        <div x-show="screen ==='landing'" x-bind:aria-hidden="not(screen ==='landing')" x-transition.duration.300ms class="personal_data">
            <h2>Rellena el formulario y te enviaremos los resultados por email</h2>
            <input type="hidden" name="utm_medium" id="utm_medium" x-model="values.utm_medium" />
            <input type="hidden" name="utm_source" id="utm_source" x-model="values.utm_source" />
            <input type="hidden" name="utm_campaign" id="utm_campaign" x-model="values.utm_campaign" />
            <input type="hidden" name="utm_content" id="utm_content" x-model="values.utm_content" />
            <input type="hidden" name="utm_term" id="utm_term" x-model="values.utm_term" />
            <input type="hidden" name="en_txn6" id="gclid" x-model="values.gclid" />
            <input type="hidden" name="en_txn7" id="ip" x-model="values.ip" />
            <input type="hidden" name="en_txn8" id="uagent" x-model="values.uagent" />
            <input type="hidden" name="last_abtest_variant" id="last_abtest_variant" value="" />
            <input type="hidden" name="hs_language" id="hs_language" x-model="values.hs_language" value="es" />
            <div class="form-group">
                <label for="first_name" class="d-none">Nombre <sup title="Campo obligatório">*</sup></label>
                <input type="text" class="form-control" id="first_name" name="first_name" required="required" maxlength="40" autocomplete="given-name" x-model="values.first_name" x-on:input="required('first_name'); $store.fname = $el.value" />
                <div class="error-message" x-text="errors.first_name" x-show="show_errors" x-bind:aria-hidden="not(show_errors)"></div>
            </div>
            <div class="form-group">
                <label for="last_name" class="d-none">Apellidos <sup title="Campo obligatório">*</sup> </label>
                <input type="text" class="form-control" id="last_name" name="last_name" required="required" maxlength="40" autocomplete="family-name" x-model="values.last_name" x-on:input="required('last_name')" />
                <div class="error-message" x-text="errors.last_name" x-show="show_errors" x-bind:aria-hidden="not(show_errors)"></div>
            </div>
            <div class="form-group">
                <label for="email" class="d-none">Email <sup title="Campo obligatório">*</sup></label>
                <input type="email" class="form-control" id="email" name="email" required="required" maxlength="50" autocomplete="email" x-model="values.email" x-on:input="is_required_email('email'); $store.email = $el.value" x-on:change="is_new_email()"  />
                <div class="error-message" x-text="errors.email" x-show="show_errors" x-bind:aria-hidden="not(show_errors)"></div>
            </div>
            <!--<div class="form-group">
                <label for="id_number" class="d-none"> <sup title="Campo obligatório">*</sup> <span class="sr-only"></span></label>
                <input type="text" class="form-control" id="id_number" name="id_number" required="required" maxlength="12" placeholder="" x-model="values.id_number" x-on:input="is_required_id_number('id_number')" />
                <div class="error-message" x-text="errors.id_number"  x-show="show_errors" x-bind:aria-hidden="not(show_errors)"></div>
            </div> -->
            <div class="form-group">
                <label for="phone_number" class="d-none">Teléfono <sup title="Campo obligatório">*</sup> <span class="sr-only">Ej. 623456789</span></label>
                <input type="tel" class="form-control" id="phone_number" name="phone_number" maxlength="15" autocomplete="tel-national" required="required" x-model="values.phone_number" x-on:input="is_required_phone('phone_number')" />
                <div class="error-message" x-text="errors.phone_number" x-show="show_errors" x-bind:aria-hidden="not(show_errors)"></div>
            </div>
            <div class="privacynotice" data-nosnippet="true">
                Quiero recibir información acerca de las campañas de Greenpeace y formas de participación. Al firmar, acepto la política de privacidad. Desde GREENPEACE ESPAÑA trataremos los datos aportados en calidad de Responsable del tratamiento con la finalidad de gestionar nuestra relación contigo, en pro de nuestros objetivos fundacionales, en base al consentimiento o a la ejecución de un acuerdo. Puedes ejercer tus derechos enviando un email a contacto.es@greenpeace.org con el asunto “Protección de Datos”. <a target="_blank" href="https://es.greenpeace.org/es/politica-de-privacidad-y-cookies/" class="privacy_policy_link_form">Más información.</a>
            </div>
            <div class="privacycontainer">
                <label for="privacy">
                    <input type="checkbox" id="privacy" name="privacy" value="Y" required="required" x-model="values.privacy" x-on:change="is_checked('privacy')" />
                    <span id="iaccept">Acepto la política de privacidad <sup title="Campo obligatório">*</sup></span>
                    <div class="error-message" x-text="errors.privacy"  x-show="show_errors" x-bind:aria-hidden="not(show_errors)"></div>
                </label>
            </div>
            <div class="buttoncontainer">
                <button type="submit" class="colored-button" x-on:click="show_errors = true; validate(); is_valid() && submit_form()"> Descarga la guía » </button>	
            </div>
        </div>
    </form>


    <div class="results" x-bind:aria-hidden="not(screen ==='thankyoupage')">
        <h2>Aquí tienes tus resultados</h2>
        <p>Te los hemos enviado también por e-mail para que los tengas a mano.</p>

        <h3>Esto es lo que podrías ahorrarte cada año</h3>

        <div class="result_box_large">
            <div class="strong_result"><span x-text="calculadora.ahorro_anual_esperado();"></span>€</div>
            <div class="footnote">Ahorro anual indicativo</div>
        </div>

        <h3>Y esto es lo que necesitarás</h3>

        <div class="results4">
            <div class="result_box_small">
                <div x-text="calculadora.numero_paneles_a_instalar();" class="strong_result"></div>
                <div>Número de paneles fotovoltaicos a instalar</div>
                <div><a href="javascript:void(0);"><img src="../assets/img/i2.svg" alt="Más información" /></a></div>
            </div>

            <div class="result_box_small">
                <div x-text="Math.round((calculadora.potencia_necesaria_para_consumo_deseado() + Number.EPSILON) * 100) / 100 ;" class="strong_result"></div>
                <div>Potencia necesaria (kWp) para cubrir tu consumo deseado</div>
            </div>

            <div class="result_box_small">
                <div class="strong_result"><span x-text="calculadora.coste_de_tu_instalacion()"></span>€</div>
                <div>Coste de tu instalación (aproximado)</div>
                <div><a href="javascript:void(0);"><img src="../assets/img/i2.svg" alt="Más información" /></a></div>
            </div>

            <div class="result_box_small">
                <div x-text="calculadora.anos_amortizacion();" class="strong_result"></div>
                <div>Años para amortizar la inversión</div>
            </div>
        </div>

        <h3>Además, reducirás tus emisiones en:</h3>

        <div class="result_box_large">
            <div x-text="calculadora.emissiones();" class="strong_result"></div>
            <div class="footnote">kg CO2 eq/kWh</div>
        </div>
        <h3>¿Quieres dar el siguiente paso?</h3>
        <p>En Greenpeace hemos elaborado una guía con todo lo que necesitas saber para iniciarte en el autoconsumo de energía solar.</p>
        <a href="javascript:void(0)">descarga tu guía de autoconsumo</a>
    </div>



</body>
</html>